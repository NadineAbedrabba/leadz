
  
  <div class="container mt-5">
    <div class="row">
      <div
        class="col-md-4"
        *ngFor="let card of cards; let i = index" 
      >
        <div class="card text-center" [class.dropped]="card.status === 'dropped'" (click)="openModal(card, i)">
          <div class="card-header text-white">
            {{ card.name }}
          </div>
          <div class="card-body">
            <p class="card-text" *ngIf="card.status !== 'dropped'">Cliquez pour afficher les détails</p>
            <p class="card-text text-danger" *ngIf="card.status === 'dropped'">
              Prospect dropped
            </p>
            <!-- Labels pour la barre de progression -->
            
              <div class="progress-labels">
                <span class="progress-label prospect-label">Prospect</span>
                <span class="progress-label client-label">Client</span>
              </div>
            
  
            <!-- Barre de progression designée -->
            <div class="progress" role="progressbar" aria-label="Animated striped example" aria-valuemin="0" aria-valuemax="100">
              <div
                class="progress-bar progress-bar-striped progress-bar-animated"
                [class.bg-success]="progressValues[i] < 100"
                [class.bg-warning]="progressValues[i] === 100"
                [style.width.%]="progressValues[i] "
              ></div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Fenêtre modale -->
  <div class="modal fade" id="stepsModal" tabindex="-1" aria-labelledby="stepsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="stepsModalLabel">Étapes pour {{ selectedCard?.name }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Liste des étapes -->
          <div class="mt-3">
            <div *ngFor="let step of selectedCard?.steps; let i = index">
              <input
                *ngIf="step.type !== 'validation'" 
                type="checkbox"
                id="step{{ i }}"
                [checked]="step.completed"
                [disabled]="!canActivateStep(i)"
                (change)="toggleStep(i)"
              />
              <label for="step{{ i }}">{{ step.name }}</label>
  
              <!-- Validation contrat et CDC uniquement comme bouton -->
              <div *ngIf="step.type === 'validation'" class="mt-3">
                <button class="btn btn-success me-3" (click)="validateStep(i)">Valider</button>
                <button class="btn btn-danger" (click)="rejectStep(i)">Refuser</button>
              </div>
  
               <!-- Boutons d'importation pour les étapes correspondantes -->
               <div *ngIf="step.name === 'Importer documents' && i === 1 && canActivateStep(i)">
                <button
                  class="btn btn-outline-primary btn-sm mt-2 me-3"
                  [disabled]="step.documents?.[0]?.imported"
                  (click)="importDocument('Proposition commerciale', i)">
                  {{ step.documents?.[0]?.imported ? 'Proposition importée' : 'Importer proposition commerciale' }}
                </button>
                <button
                  class="btn btn-outline-primary btn-sm mt-2"
                  [disabled]="step.documents?.[1]?.imported"
                  (click)="importDocument('Devis', i)">
                  {{ step.documents?.[1]?.imported ? 'Devis importé' : 'Importer devis' }}
                </button>
              </div>
              <div *ngIf="step.name === 'Importer documents' && i === 3 && canActivateStep(i)">
                <button
                  class="btn btn-outline-secondary btn-sm mt-2 me-3"
                  [disabled]="step.documents?.[1]?.imported"
                  (click)="importDocument('CDC', i)">
                  {{ step.documents?.[1]?.imported ? 'CDC importé' : 'Importer CDC' }}
                </button>
                <button
                  class="btn btn-outline-secondary btn-sm mt-2"
                  [disabled]="step.documents?.[0]?.imported"
                  (click)="importDocument('Contrat', i)">
                  {{ step.documents?.[0]?.imported ? 'Contrat importé' : 'Importer contrat' }}
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>
  